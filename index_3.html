<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Điểm tin - Quiz Game</title>
  <style>
    /* 
      ====================================================
      1) THEME VARIABLES
      ====================================================
    */
    :root {
      --bg-color: #f4f4f4;
      --text-color: #333;
      --container-bg: #fff;
      --primary-color: #007BFF;
      --secondary-color: #555;
      --border-color: #ddd;
      --answer-bg-hover: #e0e0e0;
    }
    [data-theme="dark"] {
      --bg-color: #1f1f1f;
      --text-color: #eee;
      --container-bg: #2a2a2a;
      --primary-color: #66aaff;
      --secondary-color: #ccc;
      --border-color: #555;
      --answer-bg-hover: #444;
    }
    /*
      ====================================================
      2) GLOBAL BASE STYLING
      ====================================================
    */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: background-color 0.3s, color 0.3s;
      position: relative;
      overflow-x: hidden;
    }
    a {
      color: var(--text-color);
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .container {
      max-width: 900px;
      margin: 20px auto;
      background: var(--container-bg);
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 0 12px rgba(0, 0, 0, 0.1);
      position: relative;
      transition: background-color 0.3s;
    }
    @media (max-width: 600px) {
      .container {
        padding: 15px;
      }
      h3 {
        font-size: 1.1rem;
      }
    }
    /*
      ====================================================
      3) SCOREBOARD & CONTROLS
      ====================================================
    */
    .header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
    .scoreboard {
      display: flex;
      align-items: center;
      font-size: 18px;
      font-weight: bold;
      gap: 8px;
    }
    .scoreboard-icon {
      width: 24px;
      height: 24px;
      background-color: #ffcc00;
      mask: url('data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjMDA3QkZGIiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+CjxwYXRoIGQ9Ik0xMiA1LjgybC0yLjY0LDUuMzMtNS44Ny44NjcsNCwyLjYyMWwtLjg3LDUuODcsNS4zMy0yLjY0TDExLDE5bDIuNjQtNS4zMyw1Ljg3LS44NjctNC0yLjYyMS44Ny01Ljg3LTUuMzMsMi42NE0xMiA0TDE1IDEwTDIyIDExTDE3IDE1LjE2TDExIDE0TDEwIDIxTDcgMTVIMFYxMUw2IDEwTDEyIDRaIi8+Cjwvc3ZnPg==') center/contain no-repeat;
    }
    .controls {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .controls label {
      font-weight: bold;
      color: var(--secondary-color);
    }
    .controls select {
      padding: 6px;
      font-size: 14px;
      border: 1px solid var(--border-color);
      border-radius: 3px;
      background: transparent;
      color: var(--text-color);
      outline: none;
      transition: background-color 0.2s;
    }
    .controls select:hover {
      background-color: var(--answer-bg-hover);
    }
    .btn {
      padding: 8px 16px;
      font-size: 14px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      background-color: var(--primary-color);
      color: #fff;
      transition: background-color 0.3s ease, transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .btn:hover {
      background-color: #0056b3;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    /*
      ====================================================
      4) NEWS ITEM & ANIMATIONS
      ====================================================
    */
    .news-item {
      border-bottom: 1px solid var(--border-color);
      padding: 15px 0;
      animation: slideIn 0.4s ease both;
    }
    .news-item:last-child {
      border-bottom: none;
    }
    .news-item p {
      margin: 6px 0;
      line-height: 1.5;
      transition: color 0.3s;
    }
    .news-link {
      display: inline-block;
      margin-bottom: 8px;
      font-size: 0.95rem;
      color: var(--secondary-color);
      transition: color 0.3s;
    }
    .news-link:hover {
      color: var(--text-color);
    }
    @keyframes slideIn {
      from { transform: translateX(20px); opacity: 0; }
      to   { transform: translateX(0);   opacity: 1; }
    }
    .loading {
      text-align: center;
      font-size: 16px;
      color: gray;
      margin-top: 20px;
    }
    /* 
      ====================================================
      5) BACK-TO-TOP BUTTON
      ====================================================
    */
    #back-to-top {
      position: fixed;
      bottom: 30px;
      right: 30px;
      display: none;
      background-color: var(--primary-color);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      transition: opacity 0.3s ease, background-color 0.3s;
      z-index: 9990;
    }
    #back-to-top:hover {
      background-color: #0056b3;
    }
    /*
      ====================================================
      6) ANSWER BUTTONS & FEEDBACK
      ====================================================
    */
    .answer-btn {
      display: inline-block;
      margin: 8px 8px 8px 0;
      padding: 10px 16px;
      border: 1px solid var(--border-color);
      border-radius: 12px;
      cursor: pointer;
      background-color: #f1f1f1;
      transition: transform 0.2s, background-color 0.3s, border 0.3s;
      color: #000;
      font-size: 16px;
      font-weight: 600;
    }
    [data-theme="dark"] .answer-btn {
      background-color: #444;
      color: #fff;
    }
    .answer-btn:hover {
      background-color: var(--answer-bg-hover);
      transform: scale(1.05);
    }
    .answer-btn:focus {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
    }
    .answer-btn.correct {
      background-color: #c1f0c1 !important;
      border-color: #50b750;
      color: #000;
    }
    .answer-btn.incorrect {
      background-color: #f9bdbd !important;
      border-color: #e05b5b;
      animation: shake 0.3s;
      color: #000;
    }
    @keyframes shake {
      0% { transform: translateX(0); }
      20% { transform: translateX(-6px); }
      40% { transform: translateX(6px); }
      60% { transform: translateX(-4px); }
      80% { transform: translateX(4px); }
      100% { transform: translateX(0); }
    }
    /*
      ====================================================
      7) CELEBRATION & CONFETTI
      ====================================================
    */
    #celebration {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.7);
      background-color: var(--container-bg);
      padding: 20px 30px;
      border-radius: 8px;
      border: 2px solid var(--primary-color);
      text-align: center;
      font-size: 20px;
      color: var(--text-color);
      font-weight: bold;
      opacity: 0;
      pointer-events: none;
      transition: all 0.35s ease-in-out;
      z-index: 9999;
    }
    #celebration.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }
    .confetti {
      position: fixed;
      top: 0;
      width: 10px;
      height: 10px;
      background-color: red;
      animation: fall 1.5s linear forwards;
      z-index: 9998; 
    }
    @keyframes fall {
      0% { transform: translateY(-20px) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
    /*
      ====================================================
      8) TUTORIAL OVERLAY (for first-time users)
      ====================================================
    */
    .overlay {
      position: fixed;
      top: 0; 
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9998;
    }
    .overlay.hidden {
      display: none;
    }
    .overlay-content {
      background-color: var(--container-bg);
      border: 2px solid var(--primary-color);
      border-radius: 8px;
      padding: 20px;
      max-width: 400px;
      text-align: center;
      color: var(--text-color);
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      animation: fadeInUp 0.5s ease;
    }
    @keyframes fadeInUp {
      0%   { transform: translateY(30px); opacity: 0; }
      100% { transform: translateY(0);   opacity: 1; }
    }
    /*
      ====================================================
      9) INCORRECT ANSWER MODAL
      ====================================================
    */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }
    .modal.show {
      display: flex;
    }
    .modal-content {
      background-color: var(--container-bg);
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .modal-content p {
      margin-bottom: 20px;
    }
  </style>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-W9WTM4SP');</script>
    <!-- End Google Tag Manager -->
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W9WTM4SP"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <!-- Tutorial Overlay for first-time users -->
  <div id="tutorial-overlay" class="overlay hidden">
    <div class="overlay-content">
      <h2>Chào mừng bạn đến với Quiz Game!</h2>
      <p>Trả lời nhanh tin tức nóng hổi để tích lũy điểm.<br/>
         Chọn đáp án đúng, bạn sẽ được +1 điểm và hiệu ứng pháo hoa!</p>
      <button id="tutorial-close-btn" class="btn">Bắt đầu chơi!</button>
    </div>
  </div>

  <!-- Incorrect Answer Modal -->
  <div id="incorrect-modal" class="modal">
    <div class="modal-content">
      <p id="modal-message"></p>
      <div style="margin-bottom: 20px;">
        <label>
          <input type="checkbox" id="modal-dont-show" />
          Don't show this message again
        </label>
      </div>
      <button id="modal-close-btn" class="btn">Close</button>
    </div>
  </div>

  <!-- Celebration message overlay (hidden by default) -->
  <div id="celebration">Chúc mừng! +1 điểm</div>

  <!-- BACKGROUND MUSIC (optional) -->
  <audio id="bg-music" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" loop></audio>
  <!-- Correct / Incorrect SFX -->
  <audio id="correct-sound" src="https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3"></audio>
  <audio id="incorrect-sound" src="https://www.soundjay.com/button/sounds/beep-07.mp3"></audio>

  <div class="container">
    <!-- HEADER BAR: scoreboard + controls + theme toggle + sound toggle -->
    <div class="header-bar">
      <!-- Scoreboard -->
      <div class="scoreboard">
        <div class="scoreboard-icon"></div>
        <span>Điểm của bạn:</span> 
        <span id="user-score">0</span>
      </div>

      <!-- Filter & other controls -->
      <div class="controls">
        <label for="news-filter">Điểm tin:</label>
        <select id="news-filter">
          <option value="important">Tin mới</option>
          <option value="positive">Tin vui</option>
          <option value="the-gioi">Thế Giới</option>
          <option value="thoi-su">Thời Sự</option>
          <option value="kinh-doanh">Kinh Doanh</option>
          <option value="giai-tri">Giải Trí</option>
          <option value="the-thao">Thể Thao</option>
          <option value="phap-luat">Pháp Luật</option>
          <option value="giao-duc">Giáo Dục</option>
          <option value="suc-khoe">Sức Khỏe</option>
          <option value="gia-dinh">Gia Đình</option>
          <option value="du-lich">Du Lịch</option>
          <option value="cong-nghe">Công Nghệ</option>
          <option value="oto-xe-may">Ôtô Xe Máy</option>
          <option value="tin-khac">Tin Khác</option>
        </select>

        <!-- Dark Mode Toggle -->
        <button id="toggle-theme" class="btn">Dark Mode</button>

        <!-- Sound Toggle -->
        <button id="toggle-sound" class="btn">Sound OFF</button>
      </div>
    </div>
    
    <div id="news-container"></div>
    <div id="loading" class="loading">Loading more news...</div>
  </div>
  
  <button id="back-to-top">&#8679;</button>

  <script>
    /*
      Replace this with your actual news data.
      Example structure:
      [
        {
          "title": "...",
          "link": "...",
          "content": "...",
          "importance": 10,
          "positivity": 5,
          "cat": "the-gioi",
          "question": "What is ...?",
          "answers": [
            { "text": "Option A", "correct": false },
            { "text": "Option B", "correct": true }
          ]
        },
        ...
      ]
    */
    const newsData = [{"title":"Thủ tướng triệu tập lãnh đạo địa phương Đồng bằng sông Cửu Long cùng bàn vấn đề quan trọng","content":"Vào ngày 5 tháng 3 năm 2025, Thủ tướng Phạm Minh Chính đã chủ trì cuộc họp Chính phủ thường kỳ với lãnh đạo các tỉnh Đồng bằng sông Cửu Long. Tại đây, các vấn đề liên quan đến sản xuất, tiêu thụ và xuất khẩu lúa gạo cũng như triển khai các dự án hạ tầng giao thông được thảo luận. Thủ tướng nhấn mạnh tầm quan trọng của việc đánh giá tình hình kinh tế hiện tại và yêu cầu các thành viên Chính phủ cùng đưa ra các giải pháp để duy trì ổn định kinh tế vĩ mô và thúc đẩy tăng trưởng trong bối cảnh thế giới có nhiều biến động.","link":"https://tuoitre.vn/thu-tuong-trieu-tap-lanh-dao-dia-phuong-dong-bang-song-cuu-long-cung-ban-van-de-quan-trong-20250305100636203.htm","cat":"thoi-su","positivity":8,"importance":9,"question":"Thủ tướng đã triệu tập lãnh đạo địa phương nào để thảo luận về vấn đề gì?","answers":[{"text":"Đồng bằng sông Cửu Long, sản xuất và xuất khẩu lúa gạo.","correct":true},{"text":"Đồng bằng sông Hồng, đầu tư vào công nghệ.","correct":false},{"text":"Tây Nguyên, bảo vệ môi trường.","correct":false},{"text":"Miền Trung, phát triển du lịch.","correct":false},{"text":"Đông Nam Bộ, xây dựng hạ tầng.","correct":false}]},{"title":"Cơ thủ Thanh Lực: 'Tôi muốn lên số một thế giới'","content":"Cơ thủ Trần Thanh Lực vừa trở về sau khi giành chức vô địch World Cup carom 3 băng ở Colombia. Anh mong muốn tiếp tục chinh phục các giải đấu để vươn lên vị trí số một thế giới, hiện tại anh đứng thứ năm trong bảng xếp hạng của Liên đoàn Billiard thế giới. Thanh Lực đã đánh bại Dick Jaspers ở bán kết và Tayfun Tasdemir ở chung kết để giành chức vô địch. Anh đặt mục tiêu vào top 3 thế giới trong năm 2025 và không ngừng nỗ lực để đạt được thành công hơn nữa trong sự nghiệp.","link":"https://vnexpress.net/co-thu-thanh-luc-toi-muon-len-so-mot-the-gioi-4856891.html","cat":"the-thao","positivity":9,"importance":7,"question":"Cơ thủ Trần Thanh Lực có mục tiêu gì trong tương lai gần?","answers":[{"text":"Lên số một thế giới","correct":true},{"text":"Giải nghệ sau vô địch","correct":false},{"text":"Chỉ thi đấu trong nước","correct":false},{"text":"Không có mục tiêu cụ thể","correct":false},{"text":"Tham gia giải đấu phong trào","correct":false}]},{"title":"Khởi tố nghi can trong vụ hỗn chiến khiến 1 người chết, 2 người bị thương","content":"Ngày 5-3-2025, Cơ quan cảnh sát điều tra Công an tỉnh Hà Tĩnh đã khởi tố bị can Phan Thế Anh (38 tuổi) về hành vi \"giết người\" trong vụ hỗn chiến khiến một người chết và hai người khác bị thương. Vụ việc xảy ra vào khoảng 0h20 ngày 28-2-2025, khi hai nhóm thanh niên xảy ra mâu thuẫn gần khu vực Lan Anh Club, dẫn đến xô xát và Phan Thế Anh đã dùng dao đâm anh H.T.L. (36 tuổi) gây ra cái chết cho nạn nhân. Hiện vụ việc đang được tiếp tục điều tra.","link":"https://tuoitre.vn/khoi-to-nghi-can-trong-vu-hon-chien-khien-1-nguoi-chet-2-nguoi-bi-thuong-2025030510222314.htm","cat":"phap-luat","positivity":2,"importance":8,"question":"Ai là nghi can bị khởi tố trong vụ hỗn chiến ở Hà Tĩnh?","answers":[{"text":"Phan Thế Anh","correct":true},{"text":"H.T.L.","correct":false},{"text":"Công an tỉnh Hà Tĩnh","correct":false},{"text":"Hai nhóm thanh niên","correct":false},{"text":"Nạn nhân","correct":false}]},{"title":"Đồng Tháp sẽ xử lý trách nhiệm cá nhân liên quan dự án chậm tiến độ kéo dài","content":"UBND tỉnh Đồng Tháp đã yêu cầu rà soát và xử lý trách nhiệm cá nhân liên quan đến các dự án công trình chậm tiến độ. Tỉnh sẽ yêu cầu các đơn vị hoàn thành việc xử lý các công trình tồn đọng và đưa vào sử dụng trước ngày 31-3. Các dự án đầu tư công chưa hoàn thành sẽ được đề xuất phương án xử lý dứt điểm các vướng mắc để đảm bảo hiệu quả.","link":"https://tuoitre.vn/dong-thap-se-xu-ly-trach-nhiem-ca-nhan-lien-quan-du-an-cham-tien-do-keo-dai-20250305100021163.htm","cat":"thoi-su","positivity":6,"importance":8,"question":"Đồng Tháp sẽ xử lý trách nhiệm cá nhân như thế nào liên quan đến các dự án chậm tiến độ?","answers":[{"text":"Xử lý trách nhiệm cá nhân liên quan đến các dự án chậm tiến độ.","correct":true},{"text":"Chỉ báo cáo tình hình mà không có biện pháp xử lý.","correct":false},{"text":"Đợi đến khi các dự án hoàn thành để xử lý.","correct":false},{"text":"Không có kế hoạch xử lý nào cả.","correct":false}]},{"title":"Nghị sĩ Mỹ bị đưa khỏi Hạ viện vì la ó, ngắt lời ông Trump phát biểu","content":"Nghị sĩ Al Green của đảng Dân chủ đã bị đưa ra khỏi Hạ viện khi ông liên tục ngắt lời Tổng thống Donald Trump trong bài phát biểu trước Quốc hội. Ông Green phản đối tuyên bố của ông Trump về chiến thắng trong cuộc bầu cử 2024, cho rằng không có sự tín nhiệm lớn như Tổng thống tuyên bố. Chủ tịch Hạ viện Mike Johnson đã yêu cầu ông Green ngồi xuống nhưng ông không tuân theo, dẫn đến việc nhân viên an ninh phải hộ tống ông ra ngoài để lập lại trật tự.","link":"https://dantri.com.vn/the-gioi/nghi-si-my-bi-dua-khoi-ha-vien-vi-la-o-ngat-loi-ong-trump-phat-bieu-20250305101849111.htm","cat":"thoi-su","positivity":3,"importance":7,"question":"Tại sao nghị sĩ Al Green bị đưa ra khỏi Hạ viện?","answers":[{"text":"Vì ngắt lời ông Trump trong bài phát biểu","correct":true},{"text":"Vì không đồng ý với nghị quyết của Quốc hội","correct":false},{"text":"Vì vi phạm quy định về thời gian phát biểu","correct":false},{"text":"Vì không có giấy phép tham dự phiên họp","correct":false}]},{"title":"Người Singapore ngày càng chuộng hôn nhân không con cái","content":"Ngày càng nhiều phụ nữ Singapore chọn hôn nhân không có con, với 15% phụ nữ độ tuổi 40-49 từng kết hôn không có con, gấp đôi so với năm 2004. Họ ưu tiên sự tự do và hạnh phúc cá nhân hơn là áp lực phải trở thành cha mẹ. Các chuyên gia nhận định rằng hôn nhân đang dần tách rời khỏi trách nhiệm nuôi dạy con cái, và nhiều cặp vợ chồng không cảm thấy áp lực từ xã hội về việc phải có con. Mặc dù chính phủ khuyến khích sinh thêm con, tỷ lệ sinh tại Singapore vẫn thấp và vấn đề hiếm muộn cũng đang gia tăng.","link":"https://vnexpress.net/nguoi-singapore-ngay-cang-chuong-hon-nhan-khong-con-cai-4856608.html","cat":"gia-dinh","positivity":6,"importance":7,"question":"Tại sao nhiều người Singapore chọn hôn nhân không có con?","answers":[{"text":"Họ ưu tiên sự tự do và hạnh phúc cá nhân.","correct":true},{"text":"Họ muốn duy trì nòi giống cho thế hệ sau.","correct":false},{"text":"Họ không có đủ khả năng tài chính.","correct":false},{"text":"Họ cảm thấy áp lực từ gia đình về việc phải có con.","correct":false}]},{"title":"Dân thường Ukraine mất hy vọng trước tin Mỹ cắt viện trợ quân sự","content":"Nhiều người dân Ukraine đang trải qua cảm giác hoang mang và mất hy vọng khi Mỹ quyết định tạm dừng viện trợ quân sự cho Kiev. Việc này đã khiến cho tình hình tại Kramatorsk trở nên nghiêm trọng hơn, khi mà người dân cảm thấy sự hỗ trợ từ Mỹ không còn nữa. Họ bày tỏ nỗi lo lắng về tương lai và sự cần thiết phải tiếp tục chiến đấu, trong bối cảnh nhiều người đã mất người thân trong cuộc chiến kéo dài suốt ba năm qua.","link":"https://dantri.com.vn/the-gioi/dan-thuong-ukraine-mat-hy-vong-truoc-tin-my-cat-vien-tro-quan-su-20250305081719462.htm","cat":"the-gioi","positivity":2,"importance":9,"question":"Tại sao người dân Ukraine lại cảm thấy mất hy vọng?","answers":[{"text":"Vì Mỹ cắt viện trợ quân sự cho Ukraine.","correct":true},{"text":"Vì họ không còn muốn chiến đấu.","correct":false},{"text":"Vì không có ai giúp đỡ họ.","correct":false},{"text":"Vì họ không tin vào chính phủ của mình.","correct":false}]},{"title":"Lính biên phòng và cuộc chiến chặt vòi bạch tuộc ma túy","content":"Bài viết mô tả cuộc chiến của lực lượng biên phòng Việt Nam trong việc đấu tranh chống lại các đường dây ma túy xuyên lục địa. Một trong những vụ án điển hình là việc bắt giữ một nữ du học sinh Lào, Meny, người điều hành đường dây ma túy lớn tại Hà Nội. Lực lượng chức năng đã thu giữ hàng trăm kg ma túy và tiếp tục điều tra để triệt phá các mắt xích còn lại trong tổ chức tội phạm này.","link":"https://tuoitre.vn/linh-bien-phong-va-cuoc-chien-chat-voi-bach-tuoc-ma-tuy-20250304234822473.htm","cat":"phap-luat","positivity":4,"importance":9,"question":"Cuộc chiến chống ma túy của lực lượng biên phòng liên quan đến vụ án nào?","answers":[{"text":"Nữ du học sinh Lào Meny","correct":true},{"text":"Một tổ chức buôn bán người","correct":false},{"text":"Vụ án giết người có tổ chức","correct":false},{"text":"Đường dây buôn lậu hàng hóa","correct":false}]},{"title":"Phạm Thoại bị khán giả yêu cầu cắt sóng khỏi show thực tế","content":"Phạm Thoại, một TikToker nổi tiếng, đang gặp phản đối từ khán giả về việc tham gia chương trình thực tế Miss International Queen Vietnam 2025 liên quan đến lùm xùm từ thiện trước đó. Nhiều người yêu cầu nhà sản xuất cắt sóng Phạm Thoại để bảo vệ uy tín của chương trình. Những tranh cãi xung quanh Phạm Thoại bắt nguồn từ việc anh nhận quyên góp hơn 16 tỷ đồng để hỗ trợ một bé mắc bệnh ung thư nhưng không có sự minh bạch trong khoản thu chi, khiến công chúng đặt dấu hỏi về sự trung thực của anh.","link":"https://dantri.com.vn/giai-tri/pham-thoai-bi-khan-gia-yeu-cau-cat-song-khoi-show-thuc-te-20250305085722280.htm","cat":"giai-tri","positivity":3,"importance":7,"question":"Tại sao Phạm Thoại bị yêu cầu cắt sóng khỏi chương trình thực tế?","answers":[{"text":"Vì có lùm xùm từ thiện","correct":true},{"text":"Vì không đủ tài năng","correct":false},{"text":"Vì chương trình không hấp dẫn","correct":false},{"text":"Vì có quá nhiều người tham gia","correct":false}]},{"title":"Phụ huynh đóng gần 120 triệu đồng nhưng trường mầm non liên tục đóng cửa","content":"Phụ huynh của học sinh tại Trường Mầm non quốc tế Mỹ Rosemont Việt Nam đã đóng gần 120 triệu đồng cho 10 tháng học nhưng trường liên tục đóng cửa với nhiều lý do khác nhau. Gần 50 phụ huynh đã phản ánh về tình trạng này, khiến họ bức xúc khi không thể sắp xếp chăm sóc con cái. Phòng GD&ĐT quận Thanh Xuân đã nắm được tình hình và đang làm việc với nhà trường để giải quyết vấn đề này.","link":"https://dantri.com.vn/giao-duc/phu-huynh-dong-gan-120-trieu-dong-nhung-truong-mam-non-lien-tuc-dong-cua-20250305094428504.htm","cat":"giao-duc","positivity":2,"importance":8,"question":"Tại sao phụ huynh lại bức xúc về trường mầm non quốc tế Mỹ Rosemont?","answers":[{"text":"Trường liên tục đóng cửa dù phụ huynh đã đóng học phí","correct":true},{"text":"Trường có cơ sở vật chất kém","correct":false},{"text":"Giá học phí quá cao","correct":false},{"text":"Có nhiều giáo viên không đủ trình độ","correct":false}]},{"title":"Không còn công an huyện, công an xã có thêm những nhiệm vụ, quyền hạn gì?","content":"Từ ngày 1-3, công an huyện đã chính thức giải thể, và các nhiệm vụ, quyền hạn của công an cấp huyện được chuyển giao cho công an cấp xã. Công an xã giờ đây có thêm nhiều nhiệm vụ mới như cấp đổi giấy phép lái xe, cấp phiếu lý lịch tư pháp, và xử lý vi phạm giao thông. Điều này nhằm đảm bảo không làm gián đoạn chức năng của lực lượng công an địa phương trong bối cảnh tinh gọn bộ máy.","link":"https://tuoitre.vn/khong-con-cong-an-huyen-cong-an-xa-co-them-nhung-nhiem-vu-quyen-han-gi-20250304100853667.htm","cat":"phap-luat","positivity":7,"importance":8,"question":"Công an xã hiện có những nhiệm vụ và quyền hạn mới nào?","answers":[{"text":"Cấp đổi giấy phép lái xe và phiếu lý lịch tư pháp.","correct":true},{"text":"Chỉ thực hiện các nhiệm vụ trước đây của công an huyện.","correct":false},{"text":"Không có quyền hạn mới nào.","correct":false},{"text":"Chỉ cấp căn cước công dân.","correct":false}]}];

    // Pagination & filtering
    let pageSize = 10;
    let currentIndex = 0;
    let isLoading = false;

    // Score
    let userScore = parseInt(localStorage.getItem("userScore")) || 0;
    let currentFilter = localStorage.getItem("filter") || "important";
    
    // Sound enabled?
    let soundEnabled = false; // default OFF

    // DOM elements
    const scoreboardElem = document.getElementById("user-score");
    const newsContainer = document.getElementById("news-container");
    const loadingElem = document.getElementById("loading");
    const filterDropdown = document.getElementById("news-filter");
    const backToTopBtn = document.getElementById("back-to-top");
    const celebrationElem = document.getElementById("celebration");

    // Audio elements
    const bgMusic = document.getElementById("bg-music");
    const correctSound = document.getElementById("correct-sound");
    const incorrectSound = document.getElementById("incorrect-sound");

    // Buttons
    const themeToggleBtn = document.getElementById("toggle-theme");
    const soundToggleBtn = document.getElementById("toggle-sound");

    // Initialize scoreboard
    scoreboardElem.textContent = userScore;

    // Set dropdown value
    filterDropdown.value = currentFilter;

    // FIRST-TIME USER OVERLAY
    let isFirstTimeUser = localStorage.getItem("firstTimeUser");
    if (!isFirstTimeUser) {
      document.getElementById("tutorial-overlay").classList.remove("hidden");
    }
    document.getElementById("tutorial-close-btn").addEventListener("click", () => {
      localStorage.setItem("firstTimeUser", "false");
      document.getElementById("tutorial-overlay").classList.add("hidden");
    });

    // THEMING
    function initTheme() {
      const savedTheme = localStorage.getItem("theme") || "light";
      document.body.setAttribute("data-theme", savedTheme);
      themeToggleBtn.textContent = savedTheme === "dark" ? "Light Mode" : "Dark Mode";
    }
    initTheme();

    function toggleTheme() {
      const currentTheme = document.body.getAttribute("data-theme");
      const newTheme = currentTheme === "dark" ? "light" : "dark";
      document.body.setAttribute("data-theme", newTheme);
      localStorage.setItem("theme", newTheme);
      themeToggleBtn.textContent = newTheme === "dark" ? "Light Mode" : "Dark Mode";
      pushDataLayer({event: 'theme_' + newTheme});
    }

    // SOUND
    function toggleSound() {
      soundEnabled = !soundEnabled;
      soundToggleBtn.textContent = soundEnabled ? "Sound ON" : "Sound OFF";

      if (soundEnabled) {
        bgMusic.play().catch(() => {
          console.warn("Background music couldn't play automatically.");
        });
      } else {
        bgMusic.pause();
        bgMusic.currentTime = 0;
      }
      pushDataLayer({event: soundEnabled ? "sound_on" : "sound_off"})
    }

    function playCorrectSound() {
      if (soundEnabled) correctSound.play();
    }
    function playIncorrectSound() {
      if (soundEnabled) incorrectSound.play();
    }

    // FILTER NEWS
    function getFilteredNewsData() {
      switch (currentFilter) {
        case "important":
          return newsData.filter(item => item.importance >= 8);
        case "positive":
          return newsData.filter(item => item.positivity >= 8);
        case "the-gioi":
        case "thoi-su":
        case "kinh-doanh":
        case "giai-tri":
        case "the-thao":
        case "phap-luat":
        case "giao-duc":
        case "suc-khoe":
        case "gia-dinh":
        case "du-lich":
        case "cong-nghe":
        case "oto-xe-may":
          return newsData.filter(item => item.cat === currentFilter);
        case "tin-khac":
          return newsData.filter(item => 
            !['the-gioi', 'thoi-su', 'kinh-doanh', 'giai-tri', 'the-thao', 
             'phap-luat', 'giao-duc', 'suc-khoe', 'gia-dinh', 'du-lich', 
             'cong-nghe', 'oto-xe-may', 'y-kien'].includes(item.cat)
          );
        default:
          return newsData;
      }
    }

    // CONFETTI
    function triggerConfetti() {
      const confettiCount = 20;
      for (let i = 0; i < confettiCount; i++) {
        const confetti = document.createElement("div");
        confetti.classList.add('confetti');
        confetti.style.left = Math.random() * 100 + '%';
        const hue = Math.floor(Math.random() * 360);
        confetti.style.backgroundColor = `hsl(${hue}, 100%, 50%)`;
        document.body.appendChild(confetti);
        setTimeout(() => confetti.remove(), 1500);
      }
    }

    // CELEBRATION OVERLAY
    function showCelebration() {
      celebrationElem.classList.add('show');
      triggerConfetti();
      setTimeout(() => {
        celebrationElem.classList.remove('show');
      }, 1500);
    }

    // Show Incorrect Answer Modal
    function showIncorrectModal(message) {
      const modal = document.getElementById("incorrect-modal");
      const modalMessage = document.getElementById("modal-message");
      modalMessage.textContent = message;
      modal.classList.add("show");
    }

    // Modal close listener
    document.getElementById("modal-close-btn").addEventListener("click", function() {
      const modal = document.getElementById("incorrect-modal");
      const dontShowCheckbox = document.getElementById("modal-dont-show");
      if (dontShowCheckbox.checked) {
        localStorage.setItem("dontShowIncorrectModal", "true");
        pushDataLayer({event: 'dont_show_incorrect_modal'});
      }
      modal.classList.remove("show");
    });

    // RENDER Q&A
    function renderQuestionAndAnswers(item, container, newsId) {
      const answeredKey = "answered_" + newsId;
      const contentElem = document.createElement("p");
      contentElem.textContent = item.content || "";
      const linkElem = document.createElement("a");
      linkElem.className = "news-link";
      linkElem.href = "#" + newsId;
      linkElem.textContent = "Đọc thêm...";
      linkElem.onclick = () => openNewTab(item.link);
      const questionElem = document.createElement("p");
      questionElem.id = newsId;
      questionElem.style.fontWeight = "bold";
      questionElem.textContent = item.question || "Câu hỏi:";
      container.appendChild(questionElem);
      const shuffledAnswers = shuffleArray([...item.answers]);
      const answersContainer = document.createElement("div");
      answersContainer.style.margin = "8px 0";
      shuffledAnswers.forEach(answer => {
        const answerBtn = document.createElement("button");
        answerBtn.className = "answer-btn";
        answerBtn.textContent = answer.text;
        if (localStorage.getItem(answeredKey) && answer.correct) {
          answerBtn.classList.add("correct");
        }
        answerBtn.addEventListener("click", () => {
          if (localStorage.getItem(answeredKey)) {
            pushDataLayer({event: 're_answer'});
            return;
          }
          pushDataLayer({event: 'answer'});
          if (answer.correct) {
            userScore++;
            localStorage.setItem("userScore", userScore);
            scoreboardElem.textContent = userScore;
            answerBtn.classList.add("correct");
            localStorage.setItem(answeredKey, "true");
            playCorrectSound();
            showCelebration();
          } else {
            answerBtn.classList.add("incorrect");
            setTimeout(() => {
              answerBtn.classList.remove("incorrect");
            }, 500);
            playIncorrectSound();
            const messages = [
              "Ôi không! Thử lại nào!",
              "Sai rồi... nhưng bạn vẫn còn cơ hội!",
              "Chưa đúng, đừng bỏ cuộc!",
              "Ồ, chưa chính xác. Hãy thử tiếp!"
            ];
            const randomMsg = messages[Math.floor(Math.random() * messages.length)];
            if (!localStorage.getItem("dontShowIncorrectModal")) {
              showIncorrectModal(randomMsg);
            }
          }
        });
        answersContainer.appendChild(answerBtn);
      });
      container.appendChild(answersContainer);
      container.appendChild(contentElem);
      container.appendChild(linkElem);
    }

    // LOAD MORE NEWS
    function loadMoreNews() {
      if (isLoading) return;
      isLoading = true;
      loadingElem.style.display = "block";
      setTimeout(() => {
        const filteredNews = getFilteredNewsData();
        const nextBatch = filteredNews.slice(currentIndex, currentIndex + pageSize);
        if (filteredNews.length === 0 && currentIndex === 0) {
          newsContainer.innerHTML = "<p>Không có bài viết phù hợp với bộ lọc.</p>";
          loadingElem.style.display = "none";
          window.removeEventListener("scroll", handleScroll);
          isLoading = false;
          return;
        }
        nextBatch.forEach(item => {
          const newsItem = document.createElement("div");
          newsItem.classList.add("news-item");
          const newsId = convertVietnameseToEnglish(item.title || "untitled");
          renderQuestionAndAnswers(item, newsItem, newsId);
          newsContainer.appendChild(newsItem);
        });
        currentIndex += pageSize;
        isLoading = false;
        if (currentIndex >= filteredNews.length) {
          loadingElem.style.display = "none";
          window.removeEventListener("scroll", handleScroll);
        }
      }, 500); 
    }

    // SCROLL EVENTS
    function handleScroll() {
      if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 200) {
        pushDataLayer({event: 'load_more_news'});
        loadMoreNews();
      }
      backToTopBtn.style.display = window.scrollY > 300 ? "block" : "none";
    }

    // FILTER CHANGE
    function onFilterChange() {
      currentFilter = filterDropdown.value;
      localStorage.setItem("filter", currentFilter);
      pushDataLayer({event: 'filter_changed_' + currentFilter});
      currentIndex = 0;
      newsContainer.innerHTML = "";
      loadingElem.style.display = "block";
      window.addEventListener("scroll", handleScroll);
      loadMoreNews();
    }

    // SMOOTH SCROLL TO TOP
    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
      pushDataLayer({event: 'scroll_to_top'});
    }

    // UTILS
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    function pushDataLayer(data) {
      window.dataLayer = window.dataLayer || [];
      window.dataLayer.push(data);
    }
    function openNewTab(link) {
      pushDataLayer({event: 'view_details'});
      window.open(link, '_self');
    }
    function convertVietnameseToEnglish(str) {
      str = str.toLowerCase();
      str = str.normalize('NFD');
      str = str.replace(/[\u0300-\u036f]/g, '');
      str = str.replace(/đ/g, 'd');
      str = str.replace(/[^a-z0-9\s-]/g, '');
      return str.trim().replace(/\s+/g, '-');
    }

    // INITIAL SETUP
    loadMoreNews();
    window.addEventListener("scroll", handleScroll);

    // EVENT LISTENERS
    filterDropdown.addEventListener("change", onFilterChange);
    backToTopBtn.addEventListener("click", scrollToTop);
    themeToggleBtn.addEventListener("click", toggleTheme);
    soundToggleBtn.addEventListener("click", toggleSound);
  </script>
</body>
</html>