<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Điểm tin - Quiz Game</title>
  <style>
    /* Original CSS remains mostly unchanged */
    :root {
      --bg-color: #f4f4f4;
      --text-color: #333;
      --container-bg: #fff;
      --primary-color: #007BFF;
      --secondary-color: #555;
      --border-color: #ddd;
      --answer-bg-hover: #e0e0e0;
    }
    [data-theme="dark"] {
      --bg-color: #1f1f1f;
      --text-color: #eee;
      --container-bg: #2a2a2a;
      --primary-color: #66aaff;
      --secondary-color: #ccc;
      --border-color: #555;
      --answer-bg-hover: #444;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: background-color 0.3s, color 0.3s;
      position: relative;
      overflow-x: hidden; /* Hide horizontal scroll */
    }
    .container {
      max-width: 900px;
      margin: 20px auto;
      background: var(--container-bg);
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 0 12px rgba(0, 0, 0, 0.1);
      position: relative;
      transition: background-color 0.3s;
      overflow: hidden; /* Hide any scrollbars; we’ll control navigation via swipe */
    }

    /* Responsive design: Container padding & fonts scale on smaller screens */
    @media (max-width: 600px) {
      .container {
        padding: 15px;
      }
      h3 {
        font-size: 1.1rem;
      }
    }

    /*
      ====================================================
      3) SCOREBOARD & CONTROLS
      ====================================================
    */
    .header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
    .scoreboard {
      display: flex;
      align-items: center;
      font-size: 18px;
      font-weight: bold;
      gap: 8px;
    }
    .scoreboard-icon {
      width: 24px;
      height: 24px;
      background-color: #ffcc00;
      mask: url('data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjMDA3QkZGIiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+CjxwYXRoIGQ9Ik0xMiA1LjgybC0yLjY0LDUuMzMtNS44Ny44NjcsNCwyLjYyMWwtLjg3LDUuODcsNS4zMy0yLjY0TDExLDE5bDIuNjQtNS4zMyw1Ljg3LS44NjctNC0yLjYyMS44Ny01Ljg3LTUuMzMsMi42NE0xMiA0TDE1IDEwTDIyIDExTDE3IDE1LjE2TDExIDE0TDEwIDIxTDcgMTVIMFYxMUw2IDEwTDEyIDRaIi8+Cjwvc3ZnPg==') center/contain no-repeat;
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .controls label {
      font-weight: bold;
      color: var(--secondary-color);
    }
    .controls select {
      padding: 6px;
      font-size: 14px;
      border: 1px solid var(--border-color);
      border-radius: 3px;
      background: transparent;
      color: var(--text-color);
      outline: none;
      transition: background-color 0.2s;
    }
    .controls select:hover {
      background-color: var(--answer-bg-hover);
    }

    .btn {
      padding: 8px 16px;
      font-size: 14px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      background-color: var(--primary-color);
      color: #fff;
      transition: background-color 0.3s ease, transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .btn:hover {
      background-color: #0056b3;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .news-item {
      border-bottom: 1px solid var(--border-color);
      padding: 15px 0;
      animation: slideIn 0.4s ease both;
      /* Ensure each news item fills the container width */
      width: 100%;
    }
    @keyframes slideIn {
      from { transform: translateX(20px); opacity: 0; }
      to   { transform: translateX(0);   opacity: 1; }
    }
    .loading {
      text-align: center;
      font-size: 16px;
      color: gray;
      margin-top: 20px;
    }

    /* 
      ====================================================
      5) BACK-TO-TOP BUTTON
      ====================================================
    */
    #back-to-top {
      position: fixed;
      bottom: 30px;
      right: 30px;
      display: none;
      background-color: var(--primary-color);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      transition: opacity 0.3s ease, background-color 0.3s;
      z-index: 9990;
    }
    #back-to-top:hover {
      background-color: #0056b3;
    }

    /*
      ====================================================
      6) ANSWER BUTTONS & FEEDBACK
      ====================================================
    */
    .answer-btn {
      display: inline-block;
      margin: 8px 8px 8px 0;
      padding: 8px 12px;
      border: 1px solid var(--border-color);
      border-radius: 20px;
      cursor: pointer;
      background-color: #f1f1f1;
      transition: transform 0.2s, background-color 0.3s, border 0.3s;
      color: #000;
    }
    [data-theme="dark"] .answer-btn {
      background-color: #444;
      color: #fff;
    }
    .answer-btn:hover {
      background-color: var(--answer-bg-hover);
      transform: scale(1.05);
    }
    .answer-btn.correct {
      background-color: #c1f0c1 !important;
      border-color: #50b750;
      color: #000;
    }
    .answer-btn.incorrect {
      background-color: #f9bdbd !important;
      border-color: #e05b5b;
      animation: shake 0.3s;
      color: #000;
    }
    @keyframes shake {
      0% { transform: translateX(0); }
      20% { transform: translateX(-6px); }
      40% { transform: translateX(6px); }
      60% { transform: translateX(-4px); }
      80% { transform: translateX(4px); }
      100% { transform: translateX(0); }
    }

    /*
      ====================================================
      7) CELEBRATION & CONFETTI
      ====================================================
    */
    #celebration {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.7);
      background-color: var(--container-bg);
      padding: 20px 30px;
      border-radius: 8px;
      border: 2px solid var(--primary-color);
      text-align: center;
      font-size: 20px;
      color: var(--text-color);
      font-weight: bold;
      opacity: 0;
      pointer-events: none;
      transition: all 0.35s ease-in-out;
      z-index: 9999;
    }
    #celebration.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }

    .confetti {
      position: fixed;
      top: 0;
      width: 10px;
      height: 10px;
      background-color: red;
      animation: fall 1.5s linear forwards;
      z-index: 9998; 
    }
    @keyframes fall {
      0% { transform: translateY(-20px) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }

    /*
      ====================================================
      8) TUTORIAL OVERLAY (for first-time users)
      ====================================================
    */
    .overlay {
      position: fixed;
      top: 0; 
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9998; /* Just below the #celebration */
    }
    .overlay.hidden {
      display: none;
    }
    .overlay-content {
      background-color: var(--container-bg);
      border: 2px solid var(--primary-color);
      border-radius: 8px;
      padding: 20px;
      max-width: 400px;
      text-align: center;
      color: var(--text-color);
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      animation: fadeInUp 0.5s ease;
    }
    @keyframes fadeInUp {
      0%   { transform: translateY(30px); opacity: 0; }
      100% { transform: translateY(0);   opacity: 1; }
    }
  </style>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-W9WTM4SP');</script>
    <!-- End Google Tag Manager -->
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W9WTM4SP"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <!-- Tutorial Overlay for first-time users -->
  <div id="tutorial-overlay" class="overlay hidden">
    <div class="overlay-content">
      <h2>Chào mừng bạn đến với Quiz Game!</h2>
      <p>Trả lời nhanh tin tức nóng hổi để tích lũy điểm.<br/>
         Chọn đáp án đúng, bạn sẽ được +1 điểm và hiệu ứng pháo hoa!</p>
      <button id="tutorial-close-btn" class="btn">Bắt đầu chơi!</button>
    </div>
  </div>

  <!-- Celebration message overlay (hidden by default) -->
  <div id="celebration">Chúc mừng! +1 điểm</div>

  <!-- BACKGROUND MUSIC (optional) -->
  <audio id="bg-music" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" loop></audio>
  <!-- Correct / Incorrect SFX -->
  <audio id="correct-sound" src="https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3"></audio>
  <audio id="incorrect-sound" src="https://www.soundjay.com/button/sounds/beep-07.mp3"></audio>

  <div class="container">
    <div class="header-bar">
      <div class="scoreboard">
        <div class="scoreboard-icon"></div>
        <span>Điểm của bạn:</span> 
        <span id="user-score">0</span>
      </div>
      <div class="controls">
        <label for="news-filter">Điểm tin:</label>
        <select id="news-filter">
          <!-- Options here -->
          <option value="important">Tin mới</option>
          <option value="positive">Tin vui</option>
          <option value="the-gioi">Thế Giới</option>
          <option value="thoi-su">Thời Sự</option>
          <option value="kinh-doanh">Kinh Doanh</option>
          <option value="giai-tri">Giải Trí</option>
          <option value="the-thao">Thể Thao</option>
          <option value="phap-luat">Pháp Luật</option>
          <option value="giao-duc">Giáo Dục</option>
          <option value="suc-khoe">Sức Khỏe</option>
          <option value="gia-dinh">Gia Đình</option>
          <option value="du-lich">Du Lịch</option>
          <option value="cong-nghe">Công Nghệ</option>
          <option value="oto-xe-may">Ôtô Xe Máy</option>
          <option value="y-kien">Ý Kiến</option>
          <option value="tin-khac">Tin Khác</option>
        </select>
        <button id="toggle-theme" class="btn">Dark Mode</button>
        <button id="toggle-sound" class="btn">Sound OFF</button>
      </div>
    </div>
    
    <!-- The news container now serves as the swipeable viewport -->
    <div id="news-container"></div>
    <div id="loading" class="loading">Loading more news...</div>
  </div>
  
  <script>
    /* 
      The following code implements swipe-based navigation.
      We no longer use scroll events to load news.
      Instead, we load questions in batches via loadMoreNews()
      and only show one question at a time. Swiping left advances
      to the next question; swiping right goes back.
    */
    
    // Assuming newsData is provided (e.g., from server-side rendering)
    const newsData = [{"title":"Tổng thống Mỹ tặng mũ 'Trump nói gì cũng đúng' cho phóng viên","content":"Tổng thống Mỹ Donald Trump đã tặng mũ có dòng chữ 'Trump nói gì cũng đúng' cho các phóng viên trong buổi họp báo tại Phòng Bầu dục vào ngày 25/2. Ông cho biết những chiếc mũ này được người hâm mộ gửi tặng và đề xuất làm thêm nhiều chiếc nữa. Tuy nhiên, động thái này diễn ra trong bối cảnh căng thẳng giữa ông và giới truyền thông, sau khi Nhà Trắng thông báo sẽ kiểm soát cấp phép tác nghiệp của phóng viên, khiến nhiều hiệp hội báo chí phản đối. Quyết định này được cho là đe dọa quyền tự do báo chí ở Mỹ.","link":"https://vnexpress.net/tong-thong-my-tang-mu-trump-noi-gi-cung-dung-cho-phong-vien-4854261.html","cat":"thoi-su","positivity":6,"importance":7,"question":"Tổng thống Trump đã tặng gì cho phóng viên tại Phòng Bầu dục?","answers":[{"text":"Mũ có dòng chữ 'Trump nói gì cũng đúng'","correct":true},{"text":"Sắc lệnh mới về truyền thông","correct":false},{"text":"Sách về chính trị","correct":false},{"text":"Tiền thưởng cho phóng viên","correct":false},{"text":"Bảng tên cho phóng viên","correct":false}]},{"title":"Khoảnh khắc máy bay Mỹ né phi cơ chạy cắt mặt trên đường băng","content":"Vào sáng ngày 25/2, một máy bay của hãng Southwest Airlines suýt va chạm với một phi cơ tư nhân đang chạy cắt mặt trên đường băng tại Sân bay Quốc tế Chicago Midway. Sự việc xảy ra khi máy bay Southwest Airlines hạ cánh và buộc phải tăng độ cao để tránh va chạm. Sau đó, chuyến bay đã hạ cánh an toàn 20 phút sau đó. Cục Hàng không Liên bang Mỹ (FAA) đã mở cuộc điều tra về sự việc này, trong bối cảnh một chuỗi sự cố hàng không gần đây ở Mỹ gây lo ngại.","link":"https://vnexpress.net/khoanh-khac-may-bay-my-ne-phi-co-chay-cat-mat-tren-duong-bang-4854108.html","cat":"thoi-su","positivity":7,"importance":8,"question":"Máy bay nào phải tăng độ cao để né phi cơ tư nhân trên đường băng?","answers":[{"text":"Máy bay Southwest Airlines","correct":true},{"text":"Máy bay tư nhân","correct":false},{"text":"Máy bay của hãng American Airlines","correct":false},{"text":"Máy bay chở hàng","correct":false}]},{"title":"Nhà Trắng lần đầu công bố lãnh đạo DOGE","content":"Nhà Trắng đã công bố Amy Gleason là quyền lãnh đạo của Ban Hiệu suất Chính phủ (DOGE) sau nhiều tuần từ chối công bố người đứng đầu. Gleason từng làm việc tại Cơ quan Chuyển đổi số Mỹ và có kinh nghiệm trong lĩnh vực công nghệ y tế. Sắc lệnh hành pháp thành lập DOGE đã chỉ định cơ quan này thuộc nhánh hành pháp, nhưng không đề cập đến tỷ phú Elon Musk trong vai trò lãnh đạo, mặc dù ông thường xuyên gây tranh cãi liên quan đến DOGE.","link":"https://vnexpress.net/nha-trang-lan-dau-cong-bo-lanh-dao-doge-4854118.html","cat":"thoi-su","positivity":6,"importance":7,"question":"Ai là quyền lãnh đạo của Ban Hiệu suất Chính phủ (DOGE) theo thông báo từ Nhà Trắng?","answers":[{"text":"Amy Gleason","correct":true},{"text":"Elon Musk","correct":false},{"text":"Donald Trump","correct":false},{"text":"Joe Biden","correct":false},{"text":"Kamala Harris","correct":false}]},{"title":"Israel không kích miền nam Syria","content":"Israel đã tiến hành không kích vào các mục tiêu quân sự ở miền nam Syria, bao gồm sở chỉ huy và kho vũ khí, nhằm đối phó với mối đe dọa từ sự hiện diện quân sự tại khu vực này. Bộ Quốc phòng Israel thông báo rằng các cuộc tấn công diễn ra sau khi Thủ tướng Netanyahu kêu gọi phi quân sự hóa miền nam Syria. Theo thông tin từ Tổ chức Giám sát Nhân quyền Syria, ít nhất hai người đã thiệt mạng trong các cuộc không kích này, nhưng chưa rõ họ là quân nhân hay dân thường.","link":"https://vnexpress.net/israel-khong-kich-mien-nam-syria-4854100.html","cat":"the-gioi","positivity":3,"importance":7,"question":"Tại sao Israel tiến hành không kích ở miền nam Syria?","answers":[{"text":"Để đối phó với mối đe dọa từ sự hiện diện quân sự tại khu vực.","correct":true},{"text":"Để hỗ trợ quân đội Syria.","correct":false},{"text":"Để tấn công các nhóm vũ trang dân sự.","correct":false},{"text":"Để bảo vệ các khu vực dân cư của Syria.","correct":false}]},{"title":"Ông Trump muốn Mỹ bán 'thẻ vàng' nhập cư 5 triệu USD","content":"Tổng thống Mỹ Donald Trump đã công bố một chương trình visa mới mang tên 'thẻ vàng', cho phép người nước ngoài nhập cư hợp pháp vào Mỹ với mức phí 5 triệu USD. Ông cho biết chương trình này sẽ được khởi động trong vòng hai tuần tới và không cần sự phê duyệt từ quốc hội. Thẻ vàng này sẽ thay thế chương trình visa EB-5 hiện tại, và doanh thu từ chương trình sẽ được sử dụng để giảm thâm hụt ngân sách của chính phủ.","link":"https://vnexpress.net/ong-trump-muon-my-ban-the-vang-nhap-cu-5-trieu-usd-4854089.html","cat":"thoi-su","positivity":6,"importance":7,"question":"Ông Trump đang đề xuất chương trình visa nào mới cho người nhập cư?","answers":[{"text":"Thẻ vàng","correct":true},{"text":"Thẻ xanh","correct":false},{"text":"EB-5","correct":false},{"text":"Thẻ đỏ","correct":false},{"text":"Thẻ bạc","correct":false}]},{"title":"Ukraine - Mỹ đạt được khung thỏa thuận về khoáng sản","content":"Ukraine và Mỹ đã thống nhất bộ khung cho thỏa thuận hợp tác khai thác khoáng sản, loại bỏ các điều khoản bất hợp lý với Kiev. Tổng thống Mỹ Donald Trump cho biết Tổng thống Ukraine dự kiến sẽ đến Washington vào cuối tháng này để bàn về thỏa thuận. Theo thỏa thuận, doanh thu từ việc khai thác khoáng sản sẽ được chuyển vào một quỹ đầu tư mới do cả hai nước cùng quản lý, với Ukraine đóng góp 50% doanh thu từ tài nguyên nhà nước trong tương lai.","link":"https://vnexpress.net/ukraine-my-dat-duoc-khung-thoa-thuan-ve-khoang-san-4854084.html","cat":"the-gioi","positivity":8,"importance":9,"question":"Thỏa thuận khoáng sản giữa Ukraine và Mỹ sẽ ảnh hưởng như thế nào đến quan hệ hai nước?","answers":[{"text":"Thỏa thuận sẽ củng cố quan hệ hợp tác giữa Ukraine và Mỹ.","correct":true},{"text":"Thỏa thuận không có tác động gì đến quan hệ hai nước.","correct":false},{"text":"Thỏa thuận sẽ làm cho Ukraine phụ thuộc hơn vào Mỹ.","correct":false},{"text":"Thỏa thuận chỉ ảnh hưởng đến lĩnh vực quốc phòng.","correct":false}]},{"title":"Nỗ lực của ông Macron thuyết phục ông Trump về Ukraine","content":"Tổng thống Pháp Emmanuel Macron đã có chuyến thăm Washington vào ngày 24/2 nhằm thuyết phục Tổng thống Mỹ Donald Trump hỗ trợ Ukraine và cải thiện mối quan hệ giữa châu Âu và Mỹ. Ông Macron nhấn mạnh tầm quan trọng của việc duy trì sự đoàn kết giữa Mỹ và châu Âu trong bối cảnh Trump có xu hướng xích lại gần Nga. Trong cuộc gặp, Macron đã bày tỏ quan điểm rằng không nên quá tin tưởng vào Tổng thống Nga Vladimir Putin và cần có sự răn đe mạnh mẽ từ Mỹ để bảo vệ an ninh châu Âu. Dù vậy, ông Trump không đưa ra cam kết rõ ràng về việc hỗ trợ Ukraine.","link":"https://vnexpress.net/no-luc-cua-ong-macron-thuyet-phuc-ong-trump-ve-ukraine-vnepre-4853619.html","cat":"the-gioi","positivity":5,"importance":8,"question":"Ông Macron đã làm gì trong chuyến thăm Washington để thuyết phục ông Trump về Ukraine?","answers":[{"text":"Thuyết phục ông Trump hỗ trợ Ukraine và cải thiện quan hệ châu Âu - Mỹ","correct":true},{"text":"Ký kết một thỏa thuận mới với ông Trump","correct":false},{"text":"Đưa ra cam kết quân sự cho Ukraine","correct":false},{"text":"Chỉ trích ông Putin một cách mạnh mẽ","correct":false},{"text":"Tổ chức hội nghị thượng đỉnh với các lãnh đạo châu Âu","correct":false}]},{"title":"Những đặc quyền của con cái tổng thống Mỹ","content":"Con cái của tổng thống Mỹ được hưởng nhiều đặc quyền như tổ chức sự kiện tại Nhà Trắng, di chuyển bằng chuyên cơ Air Force One và có sự bảo vệ của mật vụ. Họ cũng có cơ hội giao lưu với những nhân vật nổi tiếng và có quyền xem trước các bộ phim trước khi công chiếu. Một số con cái tổng thống đã tổ chức đám cưới và các sự kiện quan trọng tại Nhà Trắng, đồng thời gia đình tổng thống còn có đội ngũ đầu bếp phục vụ riêng.","link":"https://vnexpress.net/nhung-dac-quyen-cua-con-cai-tong-thong-my-4853184.html","cat":"the-gioi","positivity":8,"importance":7,"question":"Con cái tổng thống Mỹ có những đặc quyền gì đặc biệt?","answers":[{"text":"Tổ chức sự kiện tại Nhà Trắng","correct":true},{"text":"Không được sử dụng Air Force One","correct":false},{"text":"Không có sự bảo vệ của mật vụ","correct":false},{"text":"Không có quyền xem phim trước công chúng","correct":false}]},{"title":"Thủ tướng New Zealand đến Việt Nam","content":"Thủ tướng New Zealand Christopher Luxon đã đến Hà Nội, bắt đầu chuyến thăm chính thức Việt Nam từ ngày 25 đến 28/2 theo lời mời của Thủ tướng Phạm Minh Chính. Trong chuyến thăm, ông sẽ hội đàm với các lãnh đạo cao cấp và tham dự Diễn đàn Tương lai ASEAN lần thứ hai. Chuyến thăm này đánh dấu kỷ niệm 50 năm thiết lập quan hệ ngoại giao giữa hai nước và kỳ vọng nâng cao quan hệ đối tác giữa New Zealand và Việt Nam.","link":"https://vnexpress.net/thu-tuong-new-zealand-den-viet-nam-4854024.html","cat":"the-gioi","positivity":8,"importance":9,"question":"Thủ tướng New Zealand Christopher Luxon đến Việt Nam để làm gì?","answers":[{"text":"Để tham dự Diễn đàn Tương lai ASEAN","correct":true},{"text":"Để ký hiệp định thương mại","correct":false},{"text":"Để thăm các cơ sở quân sự","correct":false},{"text":"Để tổ chức lễ hội văn hóa","correct":false},{"text":"Để gặp gỡ cộng đồng người Việt tại New Zealand","correct":false}]},{"title":"Tranh cãi về vận động viên chuyển giới khiến bang Maine đối đầu ông Trump","content":"Tranh cãi về sắc lệnh cấm vận động viên chuyển giới tham gia thể thao nữ giữa Tổng thống Trump và Thống đốc bang Maine, Janet Mills, đã dẫn đến một cuộc đối đáp nảy lửa tại Nhà Trắng. Ông Trump yêu cầu bang Maine tuân thủ sắc lệnh nếu không muốn bị cắt giảm tài trợ liên bang, trong khi bà Mills khẳng định bang sẽ tiếp tục thực hiện luật của bang bảo vệ quyền lợi cho sinh viên chuyển giới. Cuộc tranh luận này diễn ra trong bối cảnh căng thẳng chính trị và pháp lý giữa chính quyền bang Maine và chính quyền liên bang.","link":"https://vnexpress.net/tranh-cai-ve-van-dong-vien-chuyen-gioi-khien-bang-maine-doi-dau-ong-trump-4853393.html","cat":"thoi-su","positivity":4,"importance":7,"question":"Cuộc tranh cãi giữa Tổng thống Trump và Thống đốc Maine về vấn đề gì?","answers":[{"text":"Vận động viên chuyển giới tham gia thể thao nữ","correct":true},{"text":"Chính sách thuế mới","correct":false},{"text":"Quy định về giáo dục","correct":false},{"text":"Chính sách nhập cư","correct":false}]},{"title":"Thủ tướng đề xuất ba ưu tiên chiến lược với ASEAN","content":"Thủ tướng Phạm Minh Chính đã đề xuất ba ưu tiên chiến lược cho ASEAN tại Diễn đàn Tương lai ASEAN lần thứ hai, bao gồm củng cố sự tự chủ chiến lược, xây dựng nền kinh tế tự cường và giữ vững giá trị bản sắc của ASEAN. Ông nhấn mạnh tầm quan trọng của đoàn kết và hợp tác công - tư trong việc phát triển khu vực. Diễn đàn cũng bàn luận về những thách thức và xu hướng lớn ảnh hưởng đến ASEAN trong tương lai.","link":"https://vnexpress.net/thu-tuong-de-xuat-ba-uu-tien-chien-luoc-voi-asean-4853978.html","cat":"thoi-su","positivity":8,"importance":9,"question":"Thủ tướng đã đề xuất những ưu tiên chiến lược nào cho ASEAN?","answers":[{"text":"Củng cố tự chủ, xây dựng nền kinh tế tự cường, giữ vững giá trị bản sắc","correct":true},{"text":"Tăng cường quân sự, phát triển công nghệ cao, mở rộng thị trường","correct":false},{"text":"Thúc đẩy hợp tác quốc tế, xây dựng quy trình ra quyết định, giảm thuế","correct":false},{"text":"Tăng cường đầu tư nước ngoài, phát triển du lịch, kiểm soát dịch bệnh","correct":false}]},{"title":"Israel phóng nhầm tên lửa trăm nghìn USD vì báo động giả","content":"Israel đã phóng hai tên lửa đánh chặn với tổng trị giá 100.000-200.000 USD vào một mục tiêu trên không nhưng sau đó xác định đây là báo động nhầm. Lực lượng Phòng vệ Israel (IDF) cho biết báo động không kích đã vang lên vào sáng 25/2 tại các khu định cư gần Cao nguyên Golan. Việc này đã dẫn đến sự lo ngại về mảnh vỡ từ tên lửa rơi xuống khu dân cư, và IDF đang tiến hành điều tra sự việc.","link":"https://vnexpress.net/israel-phong-nham-ten-lua-tram-nghin-usd-vi-bao-dong-gia-4853915.html","cat":"the-gioi","positivity":3,"importance":7,"question":"Tại sao Israel lại phóng nhầm tên lửa trị giá hàng trăm nghìn USD?","answers":[{"text":"Do báo động nhầm","correct":true},{"text":"Vì có thông tin tình báo sai lệch","correct":false},{"text":"Để thực hiện một cuộc tấn công trả đũa","correct":false},{"text":"Vì sự cố kỹ thuật trong hệ thống phòng không","correct":false}]},{"title":"Ông Trump phủ bóng cuộc tranh luận ứng viên thủ tướng Canada","content":"Trong cuộc tranh luận trực tiếp giữa bốn ứng viên thủ tướng Canada vào ngày 24/2, Tổng thống Donald Trump trở thành chủ đề trọng tâm khi các ứng viên thảo luận về các mối đe dọa từ ông, đặc biệt là việc áp thuế lên hàng hóa Canada. Cựu giám đốc ngân hàng trung ương Mark Carney và cựu phó thủ tướng Chrystia Freeland nhấn mạnh rằng Trump đang trở thành một mối đe dọa lớn hơn đối với Canada, với ý định biến nước này thành bang thứ 51 của Mỹ. Các ứng viên cảnh báo rằng Canada có thể rơi vào khủng hoảng kinh tế nếu các biện pháp thuế quan được thực thi.","link":"https://vnexpress.net/ong-trump-phu-bong-cuoc-tranh-luan-ung-vien-thu-tuong-canada-4853850.html","cat":"thoi-su","positivity":3,"importance":8,"question":"Ông Trump đã đe dọa điều gì đối với Canada trong cuộc tranh luận ứng viên thủ tướng?","answers":[{"text":"Áp thuế lên hàng hóa Canada","correct":true},{"text":"Sáp nhập Canada thành bang thứ 51","correct":false},{"text":"Giảm thuế cho hàng hóa Canada","correct":false},{"text":"Tăng cường hợp tác thương mại với Canada","correct":false},{"text":"Không có mối đe dọa nào","correct":false}]},{"title":"Bộ trưởng Đức: Nga sẽ không được trở lại G7","content":"Bộ trưởng Tài chính Đức, Joerg Kukies, tuyên bố rằng Nga sẽ không được phép trở lại nhóm G7, phản đối đề xuất của Tổng thống Mỹ Donald Trump. Ông nhấn mạnh rằng G7 đã lên án mạnh mẽ hành động của Nga tại Ukraine và không có sự đồng thuận cho việc Nga quay lại. Kukies cũng cho biết G7 có thể thảo luận về việc sử dụng tài sản Nga bị đóng băng để tái thiết Ukraine, nhưng các cuộc thảo luận chỉ mới bắt đầu.","link":"https://vnexpress.net/bo-truong-duc-nga-se-khong-duoc-tro-lai-g7-4853874.html","cat":"the-gioi","positivity":3,"importance":8,"question":"Tại sao Nga không được trở lại G7 theo Bộ trưởng Tài chính Đức?","answers":[{"text":"Vì G7 đã lên án chiến dịch của Nga ở Ukraine.","correct":true},{"text":"Nga không có đủ tài chính để tham gia G7.","correct":false},{"text":"Tổng thống Trump không có đủ sự ủng hộ từ các nước khác.","correct":false},{"text":"Nga đã bị đình chỉ từ lâu và không thể quay lại.","correct":false}]}];
    
    let pageSize = 10;
    let currentIndex = 0;
    let isLoading = false;
    let userScore = parseInt(localStorage.getItem("userScore")) || 0;
    let currentFilter = localStorage.getItem("filter") || "important";
    let soundEnabled = false; // default OFF

    // DOM elements
    const scoreboardElem = document.getElementById("user-score");
    const newsContainer = document.getElementById("news-container");
    const loadingElem = document.getElementById("loading");
    const filterDropdown = document.getElementById("news-filter");
    const themeToggleBtn = document.getElementById("toggle-theme");
    const soundToggleBtn = document.getElementById("toggle-sound");
    
    scoreboardElem.textContent = userScore;
    filterDropdown.value = currentFilter;

    // FIRST-TIME USER OVERLAY
    let isFirstTimeUser = localStorage.getItem("firstTimeUser");
    if (!isFirstTimeUser) {
      document.getElementById("tutorial-overlay").classList.remove("hidden");
    }
    document.getElementById("tutorial-close-btn").addEventListener("click", () => {
      localStorage.setItem("firstTimeUser", "false");
      document.getElementById("tutorial-overlay").classList.add("hidden");
    });

    // THEMING
    function initTheme() {
      const savedTheme = localStorage.getItem("theme") || "light";
      document.body.setAttribute("data-theme", savedTheme);
      themeToggleBtn.textContent = savedTheme === "dark" ? "Light Mode" : "Dark Mode";
    }
    initTheme();

    function toggleTheme() {
      const currentTheme = document.body.getAttribute("data-theme");
      const newTheme = currentTheme === "dark" ? "light" : "dark";
      document.body.setAttribute("data-theme", newTheme);
      localStorage.setItem("theme", newTheme);
      themeToggleBtn.textContent = newTheme === "dark" ? "Light Mode" : "Dark Mode";
    }
    function toggleSound() {
      soundEnabled = !soundEnabled;
      soundToggleBtn.textContent = soundEnabled ? "Sound ON" : "Sound OFF";
      // Handle bgMusic play/pause accordingly
    }
    function playCorrectSound() { if (soundEnabled) { /* play sound */ } }
    function playIncorrectSound() { if (soundEnabled) { /* play sound */ } }

    // FILTER NEWS function remains unchanged
    function getFilteredNewsData() {
      // Filtering logic based on currentFilter...
      switch (currentFilter) {
        case "important":
          return newsData.filter(item => item.importance >= 8);
        case "positive":
          return newsData.filter(item => item.positivity >= 8);
        case "the-gioi":
        case "thoi-su":
        case "kinh-doanh":
        case "giai-tri":
        case "the-thao":
        case "phap-luat":
        case "giao-duc":
        case "suc-khoe":
        case "gia-dinh":
        case "du-lich":
        case "cong-nghe":
        case "oto-xe-may":
        case "y-kien":
          return newsData.filter(item => item.cat === currentFilter);
        case "tin-khac":
          return newsData.filter(item => 
            !['the-gioi', 'thoi-su', 'kinh-doanh', 'giai-tri', 'the-thao', 
             'phap-luat', 'giao-duc', 'suc-khoe', 'gia-dinh', 'du-lich', 
             'cong-nghe', 'oto-xe-may', 'y-kien'].includes(item.cat)
          );
        default:
          return newsData;
      }
    }

    // CONFETTI
    function triggerConfetti() {
      const confettiCount = 20;
      for (let i = 0; i < confettiCount; i++) {
        const confetti = document.createElement("div");
        confetti.classList.add('confetti');
        confetti.style.left = Math.random() * 100 + '%';
        // random color
        const hue = Math.floor(Math.random() * 360);
        confetti.style.backgroundColor = `hsl(${hue}, 100%, 50%)`;

        document.body.appendChild(confetti);
        setTimeout(() => confetti.remove(), 1500);
      }
    }

    // CELEBRATION OVERLAY
    function showCelebration() {
      celebrationElem.classList.add('show');
      // Trigger confetti
      triggerConfetti();

      setTimeout(() => {
        celebrationElem.classList.remove('show');
      }, 1500);
    }

    // RENDER Q&A
    function renderQuestionAndAnswers(item, container, newsId) {
      // Build and append question text, answer buttons, etc.
      const questionElem = document.createElement("p");
      questionElem.id = newsId;
      questionElem.style.fontWeight = "bold";
      questionElem.textContent = item.question || "Câu hỏi:";
      container.appendChild(questionElem);
      
      const shuffledAnswers = shuffleArray([...item.answers]);
      const answersContainer = document.createElement("div");
      answersContainer.style.margin = "8px 0";
      shuffledAnswers.forEach(answer => {
        const answerBtn = document.createElement("button");
        answerBtn.className = "answer-btn";
        answerBtn.textContent = answer.text;
        answerBtn.addEventListener("click", () => {
          if (localStorage.getItem("answered_" + newsId)) return;
          if (answer.correct) {
            userScore++;
            localStorage.setItem("userScore", userScore);
            scoreboardElem.textContent = userScore;
            answerBtn.classList.add("correct");
            localStorage.setItem("answered_" + newsId, "true");
            playCorrectSound();
            // show celebration, trigger confetti, etc.
          } else {
            answerBtn.classList.add("incorrect");
            setTimeout(() => { answerBtn.classList.remove("incorrect"); }, 500);
            playIncorrectSound();

            const messages = [
              "Ôi không! Thử lại nào!",
              "Sai rồi... nhưng bạn vẫn còn cơ hội!",
              "Chưa đúng, đừng bỏ cuộc!",
              "Ồ, chưa chính xác. Hãy thử tiếp!"
            ];
            const randomMsg = messages[Math.floor(Math.random() * messages.length)];
            alert(randomMsg);
          }
        });
        answersContainer.appendChild(answerBtn);
      });
      container.appendChild(answersContainer);
      container.appendChild(contentElem);
      container.appendChild(linkElem);
    }

    // LOAD MORE NEWS - now sets new items to be hidden by default.
    function loadMoreNews() {
      if (isLoading) return;
      isLoading = true;
      loadingElem.style.display = "block";
      setTimeout(() => {
        const filteredNews = getFilteredNewsData();
        const nextBatch = filteredNews.slice(currentIndex, currentIndex + pageSize);
        if (filteredNews.length === 0 && currentIndex === 0) {
          newsContainer.innerHTML = "<p>Không có bài viết phù hợp với bộ lọc.</p>";
          loadingElem.style.display = "none";
          isLoading = false;
          return;
        }
        nextBatch.forEach(item => {
          const newsItem = document.createElement("div");
          newsItem.classList.add("news-item");
          // Hide each new item initially
          newsItem.style.display = "none";
          const newsId = convertVietnameseToEnglish(item.title || "untitled");
          renderQuestionAndAnswers(item, newsItem, newsId);
          newsContainer.appendChild(newsItem);
        });
        currentIndex += pageSize;
        isLoading = false;
        loadingElem.style.display = "none";
      }, 500);
    }

    // Instead of scroll events, we now use swipe gestures.
    // We'll display only one news item (question) at a time.
    let currentQuestionDisplayedIndex = 0;
    function updateDisplayedQuestion() {
      const allQuestions = document.querySelectorAll('.news-item');
      allQuestions.forEach((item, index) => {
        item.style.display = (index === currentQuestionDisplayedIndex) ? 'block' : 'none';
      });
    }

    function goToNextQuestion() {
      const allQuestions = document.querySelectorAll('.news-item');
      if (currentQuestionDisplayedIndex < allQuestions.length - 1) {
        allQuestions[currentQuestionDisplayedIndex].style.display = 'none';
        currentQuestionDisplayedIndex++;
        allQuestions[currentQuestionDisplayedIndex].style.display = 'block';
      } else {
        // Load more news if at the end; then show next question.
        loadMoreNews();
        setTimeout(() => {
          const updatedQuestions = document.querySelectorAll('.news-item');
          if (currentQuestionDisplayedIndex < updatedQuestions.length - 1) {
            updatedQuestions[currentQuestionDisplayedIndex].style.display = 'none';
            currentQuestionDisplayedIndex++;
            updatedQuestions[currentQuestionDisplayedIndex].style.display = 'block';
          }
        }, 600);
      }
    }
    
    function goToPreviousQuestion() {
      if (currentQuestionDisplayedIndex > 0) {
        const allQuestions = document.querySelectorAll('.news-item');
        allQuestions[currentQuestionDisplayedIndex].style.display = 'none';
        currentQuestionDisplayedIndex--;
        allQuestions[currentQuestionDisplayedIndex].style.display = 'block';
      }
    }

    // Add touch event listeners for swipe detection on the news container
    let touchStartX = 0;
    let touchEndX = 0;
    const swipeThreshold = 50; // Minimum px difference for a valid swipe

    newsContainer.addEventListener('touchstart', e => {
      touchStartX = e.changedTouches[0].screenX;
    });
    newsContainer.addEventListener('touchend', e => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    });
    function handleSwipe() {
      if (touchStartX - touchEndX > swipeThreshold) {
        // Detected a left swipe: move to next question
        goToNextQuestion();
      } else if (touchEndX - touchStartX > swipeThreshold) {
        // Detected a right swipe: move to previous question
        goToPreviousQuestion();
      }
    }

    // UTILS (shuffleArray, convertVietnameseToEnglish, pushDataLayer, openNewTab) remain the same.
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    function pushDataLayer(data) {
      window.dataLayer = window.dataLayer || [];
      window.dataLayer.push(data);
    }
    function openNewTab(link) {
      pushDataLayer({event: 'view_details'});
      window.open(link, '_self');
    }
    function convertVietnameseToEnglish(str) {
      str = str.toLowerCase();
      str = str.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
      str = str.replace(/đ/g, 'd').replace(/[^a-z0-9\s-]/g, '');
      return str.trim().replace(/\s+/g, '-');
    }

    // INITIAL SETUP: load first batch and display the first question.
    loadMoreNews();
    setTimeout(() => {
      updateDisplayedQuestion();
    }, 600);

    // Event listener for filter change remains the same.
    filterDropdown.addEventListener("change", onFilterChange);
    function onFilterChange() {
      currentFilter = filterDropdown.value;
      localStorage.setItem("filter", currentFilter);
      pushDataLayer({event: 'filter_changed_' + currentFilter});
      currentIndex = 0;
      newsContainer.innerHTML = "";
      loadingElem.style.display = "block";
      currentQuestionDisplayedIndex = 0;
      loadMoreNews();
      setTimeout(() => {
        updateDisplayedQuestion();
      }, 600);
    }
    themeToggleBtn.addEventListener("click", toggleTheme);
    soundToggleBtn.addEventListener("click", toggleSound);
  </script>
</body>
</html>